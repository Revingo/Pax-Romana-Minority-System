on_game_start_minorities_setup = {
	effect = {
		every_county = {
			save_scope_as = current_county

			culture_story_cycle_create = {
				COUNTY = scope:current_county
				CULTURE = scope:current_county.culture
				AMOUNT = 60.0
			}

			faith_story_cycle_create = {
				COUNTY = scope:current_county
				FAITH = scope:current_county.faith
				AMOUNT = 60.0
			}

			set_variable = {
				name = counter
				value = 0
			}

			every_neighboring_county = {
				save_scope_as = neighboring_county

				prev = {
					change_variable = {
						name = counter
						add = 1
					}

					add_to_variable_list = {
						name = to_add_cultures
						target = scope:neighboring_county.culture
					}

					add_to_variable_list = {
						name = to_add_faiths
						target = scope:neighboring_county.faith
					}
				}
			}

			if = {
				limit = { var:counter > 0 }

				set_variable = {
					name = percentage_amount
					value = average_second_section_percentage_add
				}
			}
			else = {
				set_variable = {
					name = percentage_amount
					value = 40
				}
			}

			every_in_list = {
				variable = to_add_cultures

				save_scope_as = this_culture

				scope:current_county = {

					set_variable = {
						name = repeting
						value = 0
					}

					every_neighboring_county = {
						save_scope_as = neighboring_county

						limit = { scope:this_culture = culture }

						scope:current_county = {
							change_variable = {
								name = repeting
								add = 1
							}
						}
					}

					set_variable = {
						name = corrected_percentage_amount
						value = corrected_percentage_value_calculation
					}

					remove_variable = repeting
				}

				START_GAME_culture_story_cycle_create = {
					COUNTY = scope:current_county
					CULTURE = scope:this_culture
					AMOUNT = scope:current_county.var:corrected_percentage_amount
				}

				scope:current_county = {
					remove_variable = corrected_percentage_amount
				}
			}

			every_in_list = {
				variable = to_add_faiths

				save_scope_as = this_faith

				scope:current_county = {

					set_variable = {
						name = repeting
						value = 0
					}

					every_neighboring_county = {
						save_scope_as = neighboring_county

						limit = { scope:this_faith = faith }

						scope:current_county = {
							change_variable = {
								name = repeting
								add = 1
							}
						}
					}

					set_variable = {
						name = corrected_percentage_amount
						value = corrected_percentage_value_calculation
					}

					remove_variable = repeting
				}

				START_GAME_faith_story_cycle_create = {
					COUNTY = scope:current_county
					FAITH = scope:this_faith
					AMOUNT = scope:current_county.var:corrected_percentage_amount
				}

				scope:current_county = {
					remove_variable = corrected_percentage_amount
				}
			}

			fix_faith_list = yes

			fix_culture_list = yes

			#remove_variable = counter

			#remove_variable = percentage_amount

			clear_variable_list = to_add_cultures

			clear_variable_list = to_add_faiths

			clever_culture_add = {
				CULTURE = scope:current_county.holder.culture
				AMOUNT = 5.00
			}

			clever_faith_add = {
				FAITH = scope:current_county.holder.faith
				AMOUNT = 5.00
			}
		}
	}
}

on_new_culture_minority_system = {
	effect = {
		save_scope_as = new_culture
		every_culture_county = {
			clever_culture_add = {
				CULTURE = scope:new_culture
				AMOUNT = 50
			}
		}
	}
}

on_new_faith_minority_system = {
	effect = {
		faith = {
			save_scope_as = new_faith

			every_county = {
				limit = { this.faith = scope:new_faith }
	
				clever_faith_add = {
					FAITH = scope:new_faith
					AMOUNT = 50
				}
			}
		}
	}
}

on_culture_shift_attacker_won_war = {
	effect = {

		if = {
			limit = {
				scope:defender = {
					AND = {
						is_landed = yes

						any_culture_minority_in_realm = {
							CULTURE = scope:defender.culture
						}
					}
				}
			}

			scope:defender = {
				every_realm_county = {
					clever_culture_add = {
						CULTURE = scope:defender.culture
						AMOUNT = -5
					}
				}
	
				#every_realm_border_county
				every_character_to_title_neighboring_county = {
					clever_culture_add = {
						CULTURE = scope:defender.culture
						AMOUNT = 5
					}
				}
			}
		}

		scope:attacker = {
			every_realm_county = {
				clever_culture_add = {
					CULTURE = scope:defender.culture
					AMOUNT = -5
				}
			}
		}
	}
}

on_culture_shift_defender_won_war = {
	effect = {

		if = {
			limit = {
				scope:attacker = {
					AND = {
						is_landed = yes

						any_culture_minority_in_realm = {
							CULTURE = scope:attacker.culture
						}
					}
				}
			}

			scope:attacker = {
				every_realm_county = {
					clever_culture_add = {
						CULTURE = scope:attacker.culture
						AMOUNT = -5
					}
				}
	
				#every_realm_border_county
				every_character_to_title_neighboring_county = {
					clever_culture_add = {
						CULTURE = scope:attacker.culture
						AMOUNT = 5
					}
				}
			}
		}

		scope:defender = {
			every_realm_county = {
				clever_culture_add = {
					CULTURE = scope:attacker.culture
					AMOUNT = -5
				}
			}
		}
	}
}

on_county_culture_shift_gets_sieged = {
	effect = {
		scope:barony.county = {
			save_scope_as = original_county

			culture = {
				save_scope_as = this_county_culture

				scope:barony.county = {
					clever_culture_add = {
						CULTURE = scope:this_county_culture
						AMOUNT = -10
					}
					every_neighboring_county = {
						clever_culture_add = {
							CULTURE = scope:this_county_culture
							AMOUNT = average_neighboring_counties_when_sieged
						}
					}
				}
			}
			
		}
	}
}

on_low_fervor_other_faiths_increase = {
	effect = {
		every_realm_county = {

			save_scope_as = original_county

			limit = { this.faith.fervor < 25 }

			every_neighboring_county = {
				limit = { 
					AND = {
						this.faith.fervor < 25
						NOT = { this.faith = scope:original_county.faith }
					}
				}

				save_scope_as = n_county

				scope:original_county = {
					clever_faith_add = {
						FAITH = scope:n_county.faith
						AMOUNT = 7
					}
				}
			}
		}
	}
}

on_ruler_in_debt_culture_decrease = {
	effect = {
		save_scope_as = realm_holder
		
		set_local_variable = {
			name = temp_amount
			value = -2
		}

		if = {
			limit = {
				AND = {
					debt_level > 0

					any_culture_minority_in_realm = {
						CULTURE = scope:realm_holder.culture
					}
				}
			}
			if = {
				limit = {
					debt_level > 1	
				}
				change_local_variable = {
					name = temp_amount
					add = -3
				}
			}
			if = {
				limit = {
					debt_level > 2	
				}
				change_local_variable = {
					name = temp_amount
					add = -2
				}
			}
			if = {
				limit = {
					debt_level > 3
				}
				change_local_variable = {
					name = temp_amount
					add = -1
				}
			}
			if = {
				limit = {
					debt_level > 4
				}
				change_local_variable = {
					name = temp_amount
					add = -1
				}
			}

			every_realm_county = {
				clever_culture_add = {
					CULTURE = scope:realm_holder.culture
					AMOUNT = local_var:temp_amount
				}
			}
		}
	}
}

on_ruler_piety_level_faith_change = {
	effect = {
		save_scope_as = realm_holder

		set_local_variable = {
			name = temp_amount
			value = 0
		}

		if = {
			limit = {
				AND = {
					piety_level = 0

					any_faith_minority_in_realm = {
						FAITH = scope:realm_holder.faith
					}
				}
			}

			change_local_variable = {
				name = temp_amount
				add = -5
			}

			every_realm_county = {
				clever_faith_add = {
					FAITH = scope:realm_holder.faith
					AMOUNT = local_var:temp_amount
				}
			}
		}
		else_if = {
			limit = {
				piety_level > 1
			}

			change_local_variable = {
				name = temp_amount
				add = 1
			}

			if = {
				limit = {
					piety_level > 2
				}

				change_local_variable = {
					name = temp_amount
					add = 1
				}
			}
			if = {
				limit = {
					piety_level > 3
				}

				change_local_variable = {
					name = temp_amount
					add = 2
				}
			}
			if = {
				limit = {
					piety_level > 4
				}

				change_local_variable = {
					name = temp_amount
					add = 3
				}
			}

			every_realm_county = {
				clever_faith_add = {
					FAITH = scope:realm_holder.faith
					AMOUNT = local_var:temp_amount
				}
			}
		}
	}
}

on_minorities_check = {
	effect = {
		every_realm_county = {
			fix_culture_list = yes

			change_dominant_culture = yes

			fix_faith_list = yes

			change_dominant_faith = yes
		}
	}
}

on_custom_faith_culture_minority_add = {
	effect = {

	}
}

test_on_action_minority = {
	effect = {
		every_county = {
			save_scope_as = current_county

			culture_story_cycle_create = {
				COUNTY = scope:current_county
				CULTURE = scope:current_county.culture
				AMOUNT = 60.0
			}
		}
	}
}