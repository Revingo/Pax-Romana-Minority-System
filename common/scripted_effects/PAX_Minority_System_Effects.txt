culture_story_cycle_create = {
	random_player = {

		create_story = {
			type = minority_system_story_cycle
			save_scope_as = new_culture_story_cycle	
		}

		scope:new_culture_story_cycle = {
			set_variable = {
				name = culture
				value = $CULTURE$
			}
	
			set_variable = {
				name = amount
				value = $AMOUNT$
			}
		}

		$COUNTY$ = {
			add_to_variable_list = {
				name = culture_minorities
				target = scope:new_culture_story_cycle
			}
		}
	}
}

faith_story_cycle_create = {
	random_player = {

		create_story = {
			type = minority_system_story_cycle
			save_scope_as = new_faith_story_cycle	
		}

		scope:new_faith_story_cycle = {
			set_variable = {
				name = faith
				value = $FAITH$
			}
	
			set_variable = {
				name = amount
				value = $AMOUNT$
			}
		}

		$COUNTY$ = {
			add_to_variable_list = {
				name = faith_minorities
				target = scope:new_faith_story_cycle
			}
		}
	}
}

change_value_of_culture_in_list = {
	#$COUNTY$ = {
		every_in_list = {
			variable = culture_minorities

			limit = {
				this.var:culture = $CULTURE$
			}

			change_variable = {
				name = amount
				add = $AMOUNT$
			}
		}
	#}
}

change_value_of_faith_in_list = {
	#$COUNTY$ = {
		every_in_list = {
			variable = faith_minorities

			limit = {
				this.var:faith = $FAITH$
			}

			change_variable = {
				name = amount
				add = $AMOUNT$
			}
		}
	#}
}

remove_culture_in_list = {
	$COUNTY$ = {
		every_in_list = {
			variable = culture_minorities

			limit = {
				this.var:culture = $CULTURE$
			}

			save_scope_as = to_remove_story_cycle

			prev = {
				remove_list_variable = {
					name = culture_minorities
					target = scope:to_remove_story_cycle
				}
			}
		}
	}
}

remove_faith_in_list = {
	$COUNTY$ = {
		every_in_list = {
			variable = faith_minorities

			limit = {
				this.var:faith = $FAITH$
			}

			save_scope_as = to_remove_story_cycle

			prev = {
				remove_list_variable = {
					name = faith_minorities
					target = scope:to_remove_story_cycle
				}
			}
		}
	}
}

START_GAME_culture_story_cycle_create = {
	$COUNTY$ = {
		if = {
			limit = {
				culture_is_already_in_list = {
					#COUNTY = $COUNTY$
					CULTURE = $CULTURE$
				}
			}

			change_value_of_culture_in_list = {
				#COUNTY = $COUNTY$
				CULTURE = $CULTURE$
				AMOUNT = $AMOUNT$
			}
		}
		else = {
			culture_story_cycle_create = {
				COUNTY = $COUNTY$
				CULTURE = $CULTURE$
				AMOUNT = $AMOUNT$
			}
		}
	}
}

START_GAME_faith_story_cycle_create = {
	$COUNTY$ = {
		if = {
			limit = {
				faith_is_already_in_list = {
					#COUNTY = $COUNTY$
					FAITH = $FAITH$
				}
			}

			change_value_of_faith_in_list = {
				#COUNTY = $COUNTY$
				FAITH = $FAITH$
				AMOUNT = $AMOUNT$
			}
		}
		else = {
			faith_story_cycle_create = {
				COUNTY = $COUNTY$
				FAITH = $FAITH$
				AMOUNT = $AMOUNT$
			}
		}
	}
}

fix_culture_list = {
	save_scope_as = county_to_fix

	small_culture_minorities_remover = yes

	set_variable = {
		name = total_to_add
		value = 100.0
	}

	every_in_list = {
		variable = culture_minorities

		save_scope_as = current_story_cycle

		scope:county_to_fix = {
			change_variable = {
				name = total_to_add
				subtract = scope:current_story_cycle.var:amount
			}
		}
	}

	if = {
		limit = { NOT = { var:total_to_add = 0 } }

		random_in_list = {
			variable = culture_minorities
	
			change_variable = {
				name = amount
				add = scope:county_to_fix.var:total_to_add
			}
		}
	}

	remove_variable = total_to_add

	small_culture_minorities_remover = yes
}

fix_faith_list = {
	save_scope_as = county_to_fix

	small_faith_minorities_remover = yes

	set_variable = {
		name = total_to_add
		value = 100
	}

	every_in_list = {
		variable = faith_minorities

		save_scope_as = current_story_cycle

		scope:county_to_fix = {
			change_variable = {
				name = total_to_add
				subtract = scope:current_story_cycle.var:amount
			}
		}
	}

	if = {
		limit = { NOT = { var:total_to_add = 0 } }

		random_in_list = {
			variable = faith_minorities
	
			change_variable = {
				name = amount
				add = scope:county_to_fix.var:total_to_add
			}
		}
	}

	remove_variable = total_to_add

	small_faith_minorities_remover = yes
}

clever_culture_add = {
	save_scope_as = county_add

	set_variable = {
		name = clever_counter
		value = 0
	}

	every_in_list = {
		variable = culture_minorities

		scope:county_add = {
			change_variable = {
				name = clever_counter
				add = 1
			}
		}
	}

	if = {
		limit = {
			AND = {
				culture_is_already_in_list = {
					#COUNTY = $COUNTY$
					CULTURE = $CULTURE$
				}

				var:clever_counter > 1
			}
			
		}

		change_value_of_culture_in_list = {
			#COUNTY = $COUNTY$
			CULTURE = $CULTURE$
			AMOUNT = $AMOUNT$
		}

		set_variable = {
			name = clever_subtract
			value = {
				value = $AMOUNT$
				divide = {
					value = var:clever_counter
					subtract = 1
				}
			}
		}

		every_in_list = {
			variable = culture_minorities
	
			limit = { NOT = { var:culture = $CULTURE$ } }

			change_variable = {
				name = amount
				subtract = scope:county_add.var:clever_subtract
			}
		}

		remove_variable = clever_subtract
	}
	else_if = {

		limit = {
			NOT = {
				culture_is_already_in_list = {
					#COUNTY = $COUNTY$
					CULTURE = $CULTURE$
				}
			}
		}

		culture_story_cycle_create = {
			COUNTY = scope:county_add
			CULTURE = $CULTURE$
			AMOUNT = $AMOUNT$
		}

		every_in_list = {
			variable = culture_minorities

			save_scope_as = current_county_amount_edit
	
			limit = { NOT = { var:culture = $CULTURE$ } }
	
			scope:county_add = {
				set_variable = {
					name = clever_subtract
					value = {
						value = scope:current_county_amount_edit.var:amount
						multiply = $AMOUNT$
						divide = 100
					}
				}
			}

			change_variable = {
				name = amount
				subtract = scope:county_add.var:clever_subtract
			}

			scope:county_add = {
				remove_variable = clever_subtract
			}
		}
	}

	fix_culture_list = yes

	remove_variable = clever_counter

	change_dominant_culture = yes
}

clever_faith_add = {
	save_scope_as = county_add

	set_variable = {
		name = clever_counter
		value = 0
	}

	every_in_list = {
		variable = faith_minorities

		scope:county_add = {
			change_variable = {
				name = clever_counter
				add = 1
			}
		}
	}

	if = {
		limit = {
			AND = {
				faith_is_already_in_list = {
					#COUNTY = $COUNTY$
					FAITH = $FAITH$
				}

				var:clever_counter > 1
			}
		}

		change_value_of_faith_in_list = {
			#COUNTY = $COUNTY$
			FAITH = $FAITH$
			AMOUNT = $AMOUNT$
		}

		set_variable = {
			name = clever_subtract
			value = {
				value = $AMOUNT$
				divide = {
					value = var:clever_counter
					subtract = 1
				}
			}
		}

		every_in_list = {
			variable = faith_minorities
	
			limit = { NOT = { var:faith = $FAITH$ } }

			change_variable = {
				name = amount
				subtract = scope:county_add.var:clever_subtract
			}
		}

		remove_variable = clever_subtract
	}
	else_if = {
		limit = {
			NOT = {
				faith_is_already_in_list = {
					#COUNTY = $COUNTY$
					FAITH = $FAITH$
				}
			}
		}

		faith_story_cycle_create = {
			COUNTY = scope:county_add
			FAITH = $FAITH$
			AMOUNT = $AMOUNT$
		}

		every_in_list = {
			variable = faith_minorities
	
			save_scope_as = current_county_amount_edit
	
			limit = { NOT = { var:faith = $FAITH$ } }
	
			scope:county_add = {
				set_variable = {
					name = clever_subtract
					value = {
						value = scope:current_county_amount_edit.var:amount
						multiply = $AMOUNT$
						divide = 100
					}
				}
			}

			change_variable = {
				name = amount
				subtract = scope:county_add.var:clever_subtract
			}

			scope:county_add = {
				remove_variable = clever_subtract
			}
		}
	}

	fix_faith_list = yes

	remove_variable = clever_counter

	change_dominant_faith = yes
}

change_dominant_culture = {
	save_scope_as = county_dominant_to_change

	every_in_list = {
		variable = culture_minorities

		limit = { scope:county_dominant_to_change.culture = this.var:culture }

		save_scope_as = highest_story_culture

		scope:county_dominant_to_change = {
			set_variable = {
				name = highest_culture
				value = scope:highest_story_culture
			}
		}
	}

	every_in_list = {
		variable = culture_minorities

		save_scope_as = current_culture

		limit = { this.var:amount > scope:county_dominant_to_change.var:highest_culture.var:amount }

		scope:county_dominant_to_change = {
			remove_variable = highest_culture

			set_variable = {
				name = highest_culture
				value = scope:current_culture
			}
		}
	}

	if = {
		limit = { NOT = { this.var:highest_culture.var:culture = culture  } }

		set_county_culture = this.var:highest_culture.var:culture
	}

	remove_variable = highest_culture
}

change_dominant_faith = {
	save_scope_as = county_dominant_to_change

	every_in_list = {
		variable = faith_minorities

		limit = { scope:county_dominant_to_change.faith = this.var:faith }

		save_scope_as = highest_story_faith

		scope:county_dominant_to_change = {
			set_variable = {
				name = highest_faith
				value = scope:highest_story_faith
			}
		}
	}

	every_in_list = {
		variable = faith_minorities

		save_scope_as = current_faith

		limit = { this.var:amount > scope:county_dominant_to_change.var:highest_faith.var:amount }

		scope:county_dominant_to_change = {
			remove_variable = highest_faith

			set_variable = {
				name = highest_faith
				value = scope:current_faith
			}
		}
	}

	if = {
		limit = { NOT = { this.var:highest_faith.var:faith = faith  } }

		set_county_faith = this.var:highest_faith.var:faith
	}

	remove_variable = highest_faith
}

small_culture_minorities_remover = {
	save_scope_as = county_small_minorities_remove

	every_in_list = {
		variable = culture_minorities

		save_scope_as = small_minority

		limit = { var:amount < 1}

		random_in_list = {
			variable = culture_minorities

			limit = { NOT = { scope:small_minority.var:culture = var:culture } }

			change_variable = {
				name = amount
				add = scope:small_minority.var:amount
			}
		}

		scope:county_small_minorities_remove = {
			add_to_variable_list = {
				name = small_minorities
				target = scope:small_minority
			}
		}
	}

	if = {
		limit = { has_variable_list = small_minorities }

		every_in_list = {
			variable = small_minorities

			save_scope_as = to_remove

			scope:county_small_minorities_remove = {
				remove_list_variable = {
					name = culture_minorities
					target = scope:to_remove
				}
			}
		}

		clear_variable_list = small_minorities
	}
}

small_faith_minorities_remover = {
	save_scope_as = county_small_minorities_remove

	every_in_list = {
		variable = faith_minorities

		save_scope_as = small_minority

		limit = { var:amount < 1}

		random_in_list = {
			variable = faith_minorities

			limit = { NOT = { scope:small_minority.var:faith = var:faith } }

			change_variable = {
				name = amount
				add = scope:small_minority.var:amount
			}
		}

		scope:county_small_minorities_remove = {
			add_to_variable_list = {
				name = small_minorities
				target = scope:small_minority
			}
		}
	}

	if = {
		limit = { has_variable_list = small_minorities }

		every_in_list = {
			variable = small_minorities

			save_scope_as = to_remove

			scope:county_small_minorities_remove = {
				remove_list_variable = {
					name = faith_minorities
					target = scope:to_remove
				}
			}
		}

		clear_variable_list = small_minorities
	}
}

war_culture_add = {
	if = {
		limit = {
			any_realm_county = {
				any_in_list = {
					variable = culture_minorities
	
					var:culture = $CULTURE$
				}
			}
			
		}
	}
}